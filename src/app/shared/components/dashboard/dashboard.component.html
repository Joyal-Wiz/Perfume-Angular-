<div class="dashboard-wrapper">

  <!-- SIDEBAR -->
  <div class="sidebar">

    <!-- USER CARD -->
    <div class="user-card">
      <img 
        [src]="role === 'admin' ? 'assets/img/admin1.png' : 'assets/img/user1.jpg'"
        style="height: 40px; border: 3px solid #0000007d; border-radius: 25px;">
      
      <div class="user-info">
        <h3>{{ user?.name }}</h3>
        <p>{{ user?.email }}</p>
      </div>
    </div>

    <!-- MENU -->
    <div class="menu">

      <!-- USER -->
      <ng-container *ngIf="role === 'user'">
        <button routerLink="/dashboard" class="active">ğŸ‘¤ Profile</button>
        <button routerLink="/dashboard">ğŸ“¦ My Orders</button>
        <button routerLink="/cart">ğŸ›’ My Cart</button>
        <button routerLink="/products">ğŸ› Shop More</button>
      </ng-container>

      <!-- ADMIN -->
      <ng-container *ngIf="role === 'admin'">
        <button 
          (click)="switchAdminView('dashboard')" 
          [class.active]="adminView === 'dashboard'">ğŸ›  Admin Dashboard</button>

        <button 
          (click)="switchAdminView('orders')" 
          [class.active]="adminView === 'orders'">ğŸ“‘ Manage Orders</button>

        <button routerLink="/products">ğŸ“¦ Manage Products</button>

        <button routerLink="/users/manage">ğŸ‘¥ Manage Users</button>
      </ng-container>

    </div>

  </div>

  <!-- MAIN CONTENT -->
  <div class="content">

    <!-- USER CONTENT -->
    <div *ngIf="role === 'user'">

      <div class="empty" *ngIf="userOrderedItems.length === 0">
        <img src="assets/img/empty-orders.png">
        <p>No orders yet!</p>
      </div>

      <div class="order-history-section" *ngIf="userOrderedItems.length > 0">
        <h2 class="section-title">Your Previous Orders</h2>

        <div class="orders-grid">
          <div class="ordered-item" *ngFor="let item of userOrderedItems">

            <div class="mist"></div>

            <img class="item-img" [src]="item.image">

            <div class="item-info">
              <h3>{{ item.name }}</h3>
              <p>{{ item.brand }}</p>
              <p>Qty: {{ item.quantity }}</p>
              <p class="price">â‚¹{{ item.finalPrice }}</p>
            </div>

            <span class="status delivered">Delivered</span>

            <button class="view-order-btn" (click)="viewOrder(item)">
              View Order
            </button>

          </div>
        </div>
      </div>

    </div>

    <!-- ================= ADMIN CONTENT ================= -->

    <!-- â­ ADMIN DASHBOARD VIEW -->
    <div *ngIf="role === 'admin' && adminView === 'dashboard'">

      <h2 class="section-title">Admin Dashboard</h2>

      <!-- â­â­â­ SKELETON LOADER â­â­â­ -->
      <div class="stats-grid" *ngIf="!dataLoaded">
        <div class="stat-skeleton"></div>
        <div class="stat-skeleton"></div>
        <div class="stat-skeleton"></div>
        <div class="stat-skeleton"></div>
      </div>

      <!-- â­â­â­ REAL DATA AFTER LOAD â­â­â­ -->
      <div class="stats-grid" *ngIf="dataLoaded">

        <div class="stat-card">
          <h3>{{ totalProducts }}</h3>
          <p>Total Products</p>
        </div>

        <div class="stat-card">
          <h3>{{ totalUsers }}</h3>
          <p>Total Users</p>
        </div>

        <div class="stat-card">
          <h3>{{ totalOrders }}</h3>
          <p>Total Orders</p>
        </div>

        <div class="stat-card">
          <h3>â‚¹{{ totalRevenue.toFixed(2) }}</h3>
          <p>Total Revenue</p>
        </div>

      </div>

      <div class="charts-grid">
        <div class="chart-card" [class.loaded]="chartsReady">
          <h3>Monthly Revenue</h3>
          <canvas id="salesChart"></canvas>
        </div>

        <div class="chart-card" [class.loaded]="chartsReady">
          <h3>Order Status Overview</h3>
          <canvas id="statusChart"></canvas>
        </div>
      </div>

    </div>

    <!-- â­ ADMIN â€” MANAGE ORDERS VIEW -->
    <div *ngIf="role === 'admin' && adminView === 'orders'">

      <h3 class="section-title">ğŸ› New Order Requests</h3>

      <div *ngIf="pendingOrders.length === 0" class="empty">
        <img src="assets/img/empty-orders.png">
        <p>No pending order requests</p>
      </div>

      <div class="orders-grid" *ngIf="pendingOrders.length > 0">
        <div class="ordered-item" *ngFor="let order of pendingOrders">

          <div class="mist"></div>

          <div class="item-info">
            <h3>Order #{{ order.id }}</h3>
            <p><strong>User:</strong> {{ order.checkout.email }}</p>
            <p><strong>Total:</strong> â‚¹{{ order.total }}</p>
            <p><strong>Date:</strong> {{ order.date }}</p>

            <span class="status pending">Pending</span>

            <button class="view-order-btn" (click)="openOrder(order)">
              View
            </button>
          </div>

        </div>
      </div>

    </div>

  </div>

</div>
